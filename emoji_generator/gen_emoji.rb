require 'json'
require 'htmlentities'
require 'sqlite3'
require 'unicode_utils'

emoji_data = JSON.parse(File.read "emoji.json")

# From /System/Library/Input Methods/CharacterPalette.app/Contents/Resources/Category-Emoji.plist
emoji_grouped = {
  "People" => "ğŸ˜„,ğŸ˜ƒ,ğŸ˜€,ğŸ˜Š,â˜ºï¸,ğŸ˜‰,ğŸ˜,ğŸ˜˜,ğŸ˜š,ğŸ˜—,ğŸ˜™,ğŸ˜œ,ğŸ˜,ğŸ˜›,ğŸ˜³,ğŸ˜,ğŸ˜”,ğŸ˜Œ,ğŸ˜’,ğŸ˜,ğŸ˜£,ğŸ˜¢,ğŸ˜‚,ğŸ˜­,ğŸ˜ª,ğŸ˜¥,ğŸ˜°,ğŸ˜…,ğŸ˜“,ğŸ˜©,ğŸ˜«,ğŸ˜¨,ğŸ˜±,ğŸ˜ ,ğŸ˜¡,ğŸ˜¤,ğŸ˜–,ğŸ˜†,ğŸ˜‹,ğŸ˜·,ğŸ˜,ğŸ˜´,ğŸ˜µ,ğŸ˜²,ğŸ˜Ÿ,ğŸ˜¦,ğŸ˜§,ğŸ˜ˆ,ğŸ‘¿,ğŸ˜®,ğŸ˜¬,ğŸ˜,ğŸ˜•,ğŸ˜¯,ğŸ˜¶,ğŸ˜‡,ğŸ˜,ğŸ˜‘,ğŸ‘²,ğŸ‘³,ğŸ‘®,ğŸ‘·,ğŸ’‚,ğŸ‘¶,ğŸ‘¦,ğŸ‘§,ğŸ‘¨,ğŸ‘©,ğŸ‘´,ğŸ‘µ,ğŸ‘±,ğŸ‘¼,ğŸ‘¸,ğŸ˜º,ğŸ˜¸,ğŸ˜»,ğŸ˜½,ğŸ˜¼,ğŸ™€,ğŸ˜¿,ğŸ˜¹,ğŸ˜¾,ğŸ‘¹,ğŸ‘º,ğŸ™ˆ,ğŸ™‰,ğŸ™Š,ğŸ’€,ğŸ‘½,ğŸ’©,ğŸ”¥,âœ¨,ğŸŒŸ,ğŸ’«,ğŸ’¥,ğŸ’¢,ğŸ’¦,ğŸ’§,ğŸ’¤,ğŸ’¨,ğŸ‘‚,ğŸ‘€,ğŸ‘ƒ,ğŸ‘…,ğŸ‘„,ğŸ‘,ğŸ‘,ğŸ‘Œ,ğŸ‘Š,âœŠ,âœŒï¸,ğŸ‘‹,âœ‹,ğŸ‘,ğŸ‘†,ğŸ‘‡,ğŸ‘‰,ğŸ‘ˆ,ğŸ™Œ,ğŸ™,â˜ï¸,ğŸ‘,ğŸ’ª,ğŸš¶,ğŸƒ,ğŸ’ƒ,ğŸ‘«,ğŸ‘ª,ğŸ‘¬,ğŸ‘­,ğŸ’,ğŸ’‘,ğŸ‘¯,ğŸ™†,ğŸ™…,ğŸ’,ğŸ™‹,ğŸ’†,ğŸ’‡,ğŸ’…,ğŸ‘°,ğŸ™,ğŸ™,ğŸ™‡,ğŸ©,ğŸ‘‘,ğŸ‘’,ğŸ‘Ÿ,ğŸ‘,ğŸ‘¡,ğŸ‘ ,ğŸ‘¢,ğŸ‘•,ğŸ‘”,ğŸ‘š,ğŸ‘—,ğŸ½,ğŸ‘–,ğŸ‘˜,ğŸ‘™,ğŸ’¼,ğŸ‘œ,ğŸ‘,ğŸ‘›,ğŸ‘“,ğŸ€,ğŸŒ‚,ğŸ’„,ğŸ’›,ğŸ’™,ğŸ’œ,ğŸ’š,â¤ï¸,ğŸ’”,ğŸ’—,ğŸ’“,ğŸ’•,ğŸ’–,ğŸ’,ğŸ’˜,ğŸ’Œ,ğŸ’‹,ğŸ’,ğŸ’,ğŸ‘¤,ğŸ‘¥,ğŸ’¬,ğŸ‘£,ğŸ’­",
  "Nature" => "ğŸ¶,ğŸº,ğŸ±,ğŸ­,ğŸ¹,ğŸ°,ğŸ¸,ğŸ¯,ğŸ¨,ğŸ»,ğŸ·,ğŸ½,ğŸ®,ğŸ—,ğŸµ,ğŸ’,ğŸ´,ğŸ‘,ğŸ˜,ğŸ¼,ğŸ§,ğŸ¦,ğŸ¤,ğŸ¥,ğŸ£,ğŸ”,ğŸ,ğŸ¢,ğŸ›,ğŸ,ğŸœ,ğŸ,ğŸŒ,ğŸ™,ğŸš,ğŸ ,ğŸŸ,ğŸ¬,ğŸ³,ğŸ‹,ğŸ„,ğŸ,ğŸ€,ğŸƒ,ğŸ…,ğŸ‡,ğŸ‰,ğŸ,ğŸ,ğŸ“,ğŸ•,ğŸ–,ğŸ,ğŸ‚,ğŸ²,ğŸ¡,ğŸŠ,ğŸ«,ğŸª,ğŸ†,ğŸˆ,ğŸ©,ğŸ¾,ğŸ’,ğŸŒ¸,ğŸŒ·,ğŸ€,ğŸŒ¹,ğŸŒ»,ğŸŒº,ğŸ,ğŸƒ,ğŸ‚,ğŸŒ¿,ğŸŒ¾,ğŸ„,ğŸŒµ,ğŸŒ´,ğŸŒ²,ğŸŒ³,ğŸŒ°,ğŸŒ±,ğŸŒ¼,ğŸŒ,ğŸŒ,ğŸŒ,ğŸŒš,ğŸŒ‘,ğŸŒ’,ğŸŒ“,ğŸŒ”,ğŸŒ•,ğŸŒ–,ğŸŒ—,ğŸŒ˜,ğŸŒœ,ğŸŒ›,ğŸŒ™,ğŸŒ,ğŸŒ,ğŸŒ,ğŸŒ‹,ğŸŒŒ,ğŸŒ ,â­ï¸,â˜€ï¸,â›…ï¸,â˜ï¸,âš¡ï¸,â˜”ï¸,â„ï¸,â›„ï¸,ğŸŒ€,ğŸŒ,ğŸŒˆ,ğŸŒŠ",
  "Objects" => "ğŸ,ğŸ’,ğŸ,ğŸ’,ğŸ“,ğŸ,ğŸ†,ğŸ‡,ğŸ,ğŸ‘,ğŸƒ,ğŸ‘»,ğŸ…,ğŸ„,ğŸ,ğŸ‹,ğŸ‰,ğŸŠ,ğŸˆ,ğŸŒ,ğŸ”®,ğŸ¥,ğŸ“·,ğŸ“¹,ğŸ“¼,ğŸ’¿,ğŸ“€,ğŸ’½,ğŸ’¾,ğŸ’»,ğŸ“±,â˜ï¸,ğŸ“,ğŸ“Ÿ,ğŸ“ ,ğŸ“¡,ğŸ“º,ğŸ“»,ğŸ”Š,ğŸ”‰,ğŸ”ˆ,ğŸ”‡,ğŸ””,ğŸ”•,ğŸ“¢,ğŸ“£,â³,âŒ›ï¸,â°,âŒšï¸,ğŸ”“,ğŸ”’,ğŸ”,ğŸ”,ğŸ”‘,ğŸ”,ğŸ’¡,ğŸ”¦,ğŸ”†,ğŸ”…,ğŸ”Œ,ğŸ”‹,ğŸ”,ğŸ›,ğŸ›€,ğŸš¿,ğŸš½,ğŸ”§,ğŸ”©,ğŸ”¨,ğŸšª,ğŸš¬,ğŸ’£,ğŸ”«,ğŸ”ª,ğŸ’Š,ğŸ’‰,ğŸ’°,ğŸ’´,ğŸ’µ,ğŸ’·,ğŸ’¶,ğŸ’³,ğŸ’¸,ğŸ“²,ğŸ“§,ğŸ“¥,ğŸ“¤,âœ‰ï¸,ğŸ“©,ğŸ“¨,ğŸ“¯,ğŸ“«,ğŸ“ª,ğŸ“¬,ğŸ“­,ğŸ“®,ğŸ“¦,ğŸ“,ğŸ“„,ğŸ“ƒ,ğŸ“‘,ğŸ“Š,ğŸ“ˆ,ğŸ“‰,ğŸ“œ,ğŸ“‹,ğŸ“…,ğŸ“†,ğŸ“‡,ğŸ“,ğŸ“‚,âœ‚ï¸,ğŸ“Œ,ğŸ“,âœ’ï¸,âœï¸,ğŸ“,ğŸ“,ğŸ“•,ğŸ“—,ğŸ“˜,ğŸ“™,ğŸ““,ğŸ“”,ğŸ“’,ğŸ“š,ğŸ“–,ğŸ”–,ğŸ“›,ğŸ”¬,ğŸ”­,ğŸ“°,ğŸ¨,ğŸ¬,ğŸ¤,ğŸ§,ğŸ¼,ğŸµ,ğŸ¶,ğŸ¹,ğŸ»,ğŸº,ğŸ·,ğŸ¸,ğŸ‘¾,ğŸ®,ğŸƒ,ğŸ´,ğŸ€„ï¸,ğŸ²,ğŸ¯,ğŸˆ,ğŸ€,âš½ï¸,âš¾ï¸,ğŸ¾,ğŸ±,ğŸ‰,ğŸ³,â›³ï¸,ğŸšµ,ğŸš´,ğŸ,ğŸ‡,ğŸ†,ğŸ¿,ğŸ‚,ğŸŠ,ğŸ„,ğŸ£,â˜•ï¸,ğŸµ,ğŸ¶,ğŸ¼,ğŸº,ğŸ»,ğŸ¸,ğŸ¹,ğŸ·,ğŸ´,ğŸ•,ğŸ”,ğŸŸ,ğŸ—,ğŸ–,ğŸ,ğŸ›,ğŸ¤,ğŸ±,ğŸ£,ğŸ¥,ğŸ™,ğŸ˜,ğŸš,ğŸœ,ğŸ²,ğŸ¢,ğŸ¡,ğŸ³,ğŸ,ğŸ©,ğŸ®,ğŸ¦,ğŸ¨,ğŸ§,ğŸ‚,ğŸ°,ğŸª,ğŸ«,ğŸ¬,ğŸ­,ğŸ¯,ğŸ,ğŸ,ğŸŠ,ğŸ‹,ğŸ’,ğŸ‡,ğŸ‰,ğŸ“,ğŸ‘,ğŸˆ,ğŸŒ,ğŸ,ğŸ,ğŸ ,ğŸ†,ğŸ…,ğŸŒ½",
  "Places" => "ğŸ ,ğŸ¡,ğŸ«,ğŸ¢,ğŸ£,ğŸ¥,ğŸ¦,ğŸª,ğŸ©,ğŸ¨,ğŸ’’,â›ªï¸,ğŸ¬,ğŸ¤,ğŸŒ‡,ğŸŒ†,ğŸ¯,ğŸ°,â›ºï¸,ğŸ­,ğŸ—¼,ğŸ—¾,ğŸ—»,ğŸŒ„,ğŸŒ…,ğŸŒƒ,ğŸ—½,ğŸŒ‰,ğŸ ,ğŸ¡,â›²ï¸,ğŸ¢,ğŸš¢,â›µï¸,ğŸš¤,ğŸš£,âš“ï¸,ğŸš€,âœˆï¸,ğŸ’º,ğŸš,ğŸš‚,ğŸšŠ,ğŸš‰,ğŸš,ğŸš†,ğŸš„,ğŸš…,ğŸšˆ,ğŸš‡,ğŸš,ğŸš‹,ğŸšƒ,ğŸš,ğŸšŒ,ğŸš,ğŸš™,ğŸš˜,ğŸš—,ğŸš•,ğŸš–,ğŸš›,ğŸšš,ğŸš¨,ğŸš“,ğŸš”,ğŸš’,ğŸš‘,ğŸš,ğŸš²,ğŸš¡,ğŸšŸ,ğŸš ,ğŸšœ,ğŸ’ˆ,ğŸš,ğŸ«,ğŸš¦,ğŸš¥,âš ï¸,ğŸš§,ğŸ”°,â›½ï¸,ğŸ®,ğŸ°,â™¨ï¸,ğŸ—¿,ğŸª,ğŸ­,ğŸ“,ğŸš©,ğŸ‡¯ğŸ‡µ,ğŸ‡°ğŸ‡·,ğŸ‡©ğŸ‡ª,ğŸ‡¨ğŸ‡³,ğŸ‡ºğŸ‡¸,ğŸ‡«ğŸ‡·,ğŸ‡ªğŸ‡¸,ğŸ‡®ğŸ‡¹,ğŸ‡·ğŸ‡º,ğŸ‡¬ğŸ‡§",
  "Symbols" => "0ï¸âƒ£,1ï¸âƒ£,2ï¸âƒ£,3ï¸âƒ£,4ï¸âƒ£,5ï¸âƒ£,6ï¸âƒ£,7ï¸âƒ£,8ï¸âƒ£,9ï¸âƒ£,ğŸ”Ÿ,ğŸ”¢,#ï¸âƒ£,ğŸ”£,â¬†ï¸,â¬‡ï¸,â¬…ï¸,â¡ï¸,ğŸ” ,ğŸ”¡,ğŸ”¤,â†—ï¸,â†–ï¸,â†˜ï¸,â†™ï¸,â†”ï¸,â†•ï¸,ğŸ”„,â—€ï¸,â–¶ï¸,ğŸ”¼,ğŸ”½,â†©ï¸,â†ªï¸,â„¹ï¸,âª,â©,â«,â¬,â¤µï¸,â¤´ï¸,ğŸ†—,ğŸ”€,ğŸ”,ğŸ”‚,ğŸ†•,ğŸ†™,ğŸ†’,ğŸ†“,ğŸ†–,ğŸ“¶,ğŸ¦,ğŸˆ,ğŸˆ¯ï¸,ğŸˆ³,ğŸˆµ,ğŸˆ´,ğŸˆ²,ğŸ‰,ğŸˆ¹,ğŸˆº,ğŸˆ¶,ğŸˆšï¸,ğŸš»,ğŸš¹,ğŸšº,ğŸš¼,ğŸš¾,ğŸš°,ğŸš®,ğŸ…¿ï¸,â™¿ï¸,ğŸš­,ğŸˆ·,ğŸˆ¸,ğŸˆ‚,â“‚ï¸,ğŸ›‚,ğŸ›„,ğŸ›…,ğŸ›ƒ,ğŸ‰‘,ãŠ™ï¸,ãŠ—ï¸,ğŸ†‘,ğŸ†˜,ğŸ†”,ğŸš«,ğŸ”,ğŸ“µ,ğŸš¯,ğŸš±,ğŸš³,ğŸš·,ğŸš¸,â›”ï¸,âœ³ï¸,â‡ï¸,â,âœ…,âœ´ï¸,ğŸ’Ÿ,ğŸ†š,ğŸ“³,ğŸ“´,ğŸ…°,ğŸ…±,ğŸ†,ğŸ…¾,ğŸ’ ,â¿,â™»ï¸,â™ˆï¸,â™‰ï¸,â™Šï¸,â™‹ï¸,â™Œï¸,â™ï¸,â™ï¸,â™ï¸,â™ï¸,â™‘ï¸,â™’ï¸,â™“ï¸,â›,ğŸ”¯,ğŸ§,ğŸ’¹,ğŸ’²,ğŸ’±,Â©,Â®,â„¢,âŒ,â€¼ï¸,â‰ï¸,â—ï¸,â“,â•,â”,â­•ï¸,ğŸ”,ğŸ”š,ğŸ”™,ğŸ”›,ğŸ”œ,ğŸ”ƒ,ğŸ•›,ğŸ•§,ğŸ•,ğŸ•œ,ğŸ•‘,ğŸ•,ğŸ•’,ğŸ•,ğŸ•“,ğŸ•Ÿ,ğŸ•”,ğŸ• ,ğŸ••,ğŸ•–,ğŸ•—,ğŸ•˜,ğŸ•™,ğŸ•š,ğŸ•¡,ğŸ•¢,ğŸ•£,ğŸ•¤,ğŸ•¥,ğŸ•¦,âœ–ï¸,â•,â–,â—,â™ ï¸,â™¥ï¸,â™£ï¸,â™¦ï¸,ğŸ’®,ğŸ’¯,âœ”ï¸,â˜‘ï¸,ğŸ”˜,ğŸ”—,â°,ã€°,ã€½ï¸,ğŸ”±,â—¼ï¸,â—»ï¸,â—¾ï¸,â—½ï¸,â–ªï¸,â–«ï¸,ğŸ”º,ğŸ”²,ğŸ”³,âš«ï¸,âšªï¸,ğŸ”´,ğŸ”µ,ğŸ”»,â¬œï¸,â¬›ï¸,ğŸ”¶,ğŸ”·,ğŸ”¸,ğŸ”¹",
}

emoji_named = JSON.parse(File.read "emoji_grouped.json")



db = SQLite3::Database.new( "/System/Library/Input Methods/CharacterPalette.app/Contents/Resources/CharacterDB.sqlite3" )

emoji_cheats = ''

emoji_grouped.each_key do |group|
  emojis = emoji_grouped[group].split(',')
  puts "#{group} #{emojis.count}"
  
  emoji_entries = ''
  
  emojis.each do |emoji_char|
    
    rows = db.execute("select * from unihan_dict where uchr like ?", emoji_char)
    # rows are of form ["9ï¸âƒ£", "KEYCAP 9|||||||||||||||"]
    emoji_name = rows.first[1].split("|").first
    
    char_data = emoji_data.select{|data|data["name"]==emoji_name}.first
    

    emoji_name.capitalize!
    
    ## fix some edge cases
    emoji_char = "\\#ï¸âƒ£"if emoji_char == "#ï¸âƒ£"
    emoji_name.gsub!(/^(.* letter)( \w{1,2})$/) { "#{$1}#{$2.to_s.upcase}" }
    emoji_name.gsub!(/^(Squared )(\w{1,3})( .*)?$/) { "#{$1}#{$2.to_s.upcase}#{$3}" }
    emoji_name.gsub!(/^(Squared CJK unified ideograph-)(\w+)$/) { "#{$1}#{$2.to_s.upcase}" }
    emoji_name.gsub!(/^(Regional indicator symbol letters )(\w{2})$/) { "#{$1}#{$2.to_s.upcase}" }
    emoji_name.gsub!(/^(Negative squared)(.*)( \w{1,2})$/) { "#{$1}#{$2}#{$3.to_s.upcase}" }
    ##
    
    
    emoji_entries << <<-ENTRY
    entry do
      command ':#{char_data["short_name"]}:'
      name    '#{emoji_char} #{emoji_name}'
      notes   'Unified: `#{char_data["unified"]}`'
    end
    ENTRY
  end
  
  emoji_cheats << <<-CATEGORY
  category do
    id '#{group}'
    
#{emoji_entries}
  end
CATEGORY

end

cheatfile = ''
cheatfile << <<-CHEATSHEET
cheatsheet do
  title 'Emoji'
  docset_file_name 'Emoji'
  keyword 'emoji'
  source_url 'http://cheat.kapeli.com'
  
  #{emoji_cheats}
  
  notes 'Information obtained from:
  
* https://bitbucket.org/grumdrig/emoji-list/
* https://github.com/arvida/emoji-cheat-sheet.com
* https://github.com/iamcal/emoji-data
* http://www.unicode.org/~scherer/emoji4unicode/snapshot/emojidata.html'

end
CHEATSHEET

File.open('emoji.rb','w+') { |f| f << cheatfile }

`cheatset generate emoji.rb`
